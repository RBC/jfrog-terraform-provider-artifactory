---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "artifactory_archive_policy Resource - terraform-provider-artifactory"
subcategory: "Configuration"
description: |-
  Provides an Artifactory Archive Policy resource. This resource enable system administrators to define and customize policies based on specific criteria for removing unused binaries from across their JFrog platform. See Archive Policies https://jfrog.com/help/r/jfrog-platform-administration-documentation/retention-policies for more details.
  ~>Currently in beta and not yet globally available. A full rollout is scheduled for Q1 2025.
---

# artifactory_archive_policy (Resource)

Provides an Artifactory Archive Policy resource. This resource enable system administrators to define and customize policies based on specific criteria for removing unused binaries from across their JFrog platform. See [Archive Policies](https://jfrog.com/help/r/jfrog-platform-administration-documentation/retention-policies) for more details.

~>Currently in beta and not yet globally available. A full rollout is scheduled for Q1 2025.

## Example Usage

```terraform
resource "artifactory_local_docker_v2_repository" "my-docker-local" {
  key             = "my-docker-local"
  tag_retention   = 3
  max_unique_tags = 5

  lifecycle {
    ignore_changes = ["project_key"]
  }
}

resource "project" "myproj" {
  key = "myproj"
  display_name = "Test Project"
  description  = "Test Project"
  admin_privileges {
    manage_members   = true
    manage_resources = true
    index_resources  = true
  }
  max_storage_in_gibibytes   = 10
  block_deployments_on_limit = false
  email_notification         = true
}

resource "project_repository" "myproj-my-docker-local" {
  project_key = project.myproj.key
  key = artifactory_local_docker_v2_repository.my-docker-local.key
}

resource "artifactory_archive_policy" "my-archive-policy" {
  key = "my-archive-policy"
  description = "My archive policy"
  cron_expression = "0 0 2 ? * MON-SAT *"
  duration_in_minutes = 60
  enabled = true
  skip_trashcan = false
  project_key = project_repository.myproj-my-docker-local.project_key
  
  search_criteria = {
    package_types = [
      "docker",
    ]
    repos = [
      project_repository.myproj-my-docker-local.key,
    ]
    excluded_repos = ["gradle-global"]
    include_all_projects = false
    included_projects = []
    included_packages = ["com/jfrog"]
    excluded_packages = ["com/jfrog/latest"]
    created_before_in_months = 1
    last_downloaded_before_in_months = 6
    keep_last_n_versions = 0
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `key` (String) An ID that is used to identify the archive policy. A minimum of three characters is required and can include letters, numbers, underscore and hyphen.
- `search_criteria` (Attributes) (see [below for nested schema](#nestedatt--search_criteria))

### Optional

- `cron_expression` (String) The cron expression determines when the policy is run. This parameter is not mandatory, however if left empty the policy will not run automatically and can only be triggered manually.
- `description` (String)
- `duration_in_minutes` (Number) The maximum duration (in minutes) for policy execution, after which the policy will stop running even if not completed. While setting a maximum run duration for a policy is useful for adhering to a strict archive V2 schedule, it can cause the policy to stop before completion.
- `enabled` (Boolean) Enables or disabled the package cleanup policy. This allows the user to run the policy manually. If a policy has a valid cron expression, then it will be scheduled for execution based on it. If a policy is disabled, its future executions will be unscheduled. Defaults to `true`
- `project_key` (String) This attribute is used only for project-level archive V2 policies, it is not used for global-level policies.
- `skip_trashcan` (Boolean) A `true` value means that when this policy is executed, packages will be permanently deleted. `false` means that when the policy is executed packages will be deleted to the Trash Can. Defaults to `false`.

~>The Global Trash Can setting must be enabled if you want deleted items to be transferred to the Trash Can. For information on enabling global Trash Can settings, see [Trash Can Settings](https://jfrog.com/help/r/jfrog-artifactory-documentation/trash-can-settings).

<a id="nestedatt--search_criteria"></a>
### Nested Schema for `search_criteria`

Required:

- `included_packages` (Set of String) Specify a pattern for a package name or an explicit package name. It accept only single element which can be specific package or pattern, and for including all packages use `**`. Example: `included_packages = ["**"]`
- `package_types` (Set of String) The package types that are archived by the policy. Support: cargo, cocoapods, conan, debian, docker, gems, generic, go, gradle, helm, helmoci, huggingfaceml, maven, npm, nuget, oci, pypi, rpm, terraform.
- `repos` (Set of String) Specify one or more patterns for the repository name(s) on which you want the archive policy to run. You can also specify explicit repository names. Specifying at least one pattern or explicit name is required. Only packages in repositories that match the pattern or explicit name will be archived. For including all repos use `**`. Example: `repos = ["**"]`

Optional:

- `created_before_in_months` (Number) The archive policy will archive packages based on how long ago they were created. For example, if this parameter is 2 then packages created more than 2 months ago will be archived as part of the policy.
- `excluded_packages` (Set of String) Specify explicit package names that you want excluded from the policy. Only Name explicit names (and not patterns) are accepted.
- `excluded_repos` (Set of String) Specify patterns for repository names or explicit repository names that you want excluded from the archive policy.
- `include_all_projects` (Boolean) Set this value to `true` if you want the policy to run on all Artifactory projects. The default value is `false`.

~>This attribute is relevant only on the global level, for Platform Admins.
- `included_projects` (Set of String) List of projects on which you want this policy to run. To include repositories that are not assigned to any project, enter the project key `default`.

~>This setting is relevant only on the global level, for Platform Admins.
- `keep_last_n_versions` (Number) Set a value for the number of latest versions to keep. The archive policy will remove all versions before the number you select here. The latest version is always excluded.

~>Versions are determined by creation date.

~>Not all package types support this condition. If you include a package type in your policy that is not compatible with this condition, a validation error (400) is returned. For information on which package types support this condition, see [here]().
- `last_downloaded_before_in_months` (Number) The archive policy will archive packages based on how long ago they were downloaded. For example, if this parameter is 5 then packages downloaded more than 5 months ago will be archived as part of the policy.

~>JFrog recommends using the `last_downloaded_before_in_months` condition to ensure that packages currently in use are not archived.

## Import

Import is supported using the following syntax:

```shell
terraform import artifactory_archive_policy.my-archive-policy my-policy

terraform import artifactory_archive_policy.my-archive-policy my-policy:myproj
```
